{% extends "tasks/layout.html" %}
{% load static %}

{% block body %}
<h2>Add Task</h2>

<form id="task-form" method="post" action="{% url 'add_task' %}">
  {% csrf_token %}
  {{ form.as_p }}

  <!-- Dependencies (JS will append rows here) -->
  <div id="dependencies-container" class="mb-3"></div>
  <button type="button" id="add-dependency-btn" class="btn btn-outline-secondary mb-3">+ Add Dependency</button>

  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Save Task</button>
    <a href="{% url 'index' %}" class="btn btn-secondary">Cancel</a>
  </div>
</form>

<!-- Provide existing tasks to JS as JSON. Build a small list in view and pass as `tasks`. -->
<script id="existing-tasks" type="application/json">
  {{ tasks_json|safe }}
</script>

<script id="tasks-data" type="application/json">
  {{ tasks_json|safe }}
</script>


<!-- If your Django doesn't support the exact json_script usage in your version, fallback to:
<script id="existing-tasks" type="application/json">{{ tasks_json|safe }}</script>
where `tasks_json` is created in the view as json.dumps(list_of_dicts).
-->

<script src="{% static 'js/add_task.js' %}"></script>
{% endblock %}
