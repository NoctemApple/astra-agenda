{% extends "tasks/layout.html" %}
{% block body %}
<h2>{{ task.name }}</h2>
<p><strong>Description:</strong> {{ task.description|default:"No description" }}</p>
<p><strong>Status:</strong> {% if task.completed %}✅ Completed{% else %}❌ In Progress{% endif %}</p>

<div class="accordion" id="dependencyAccordion{{ task.id }}">
  {% for group in dependency_groups %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="depHeading{{ group.id }}">
        <button class="accordion-button collapsed" type="button"
                data-bs-toggle="collapse"
                data-bs-target="#depCollapse{{ group.id }}">
          {% if group.group_type == "ALL" %}
            Required (All must be completed)
          {% elif group.group_type == "ONE" %}
            Either (At least one must be completed)
          {% elif group.group_type == "OPT" %}
            Optional
          {% endif %}
        </button>
      </h2>
      <div id="depCollapse{{ group.id }}" class="accordion-collapse collapse"
           data-bs-parent="#dependencyAccordion{{ task.id }}">
        <div class="accordion-body">
          <ul>
            {% for dep in group.dependencies.all %}
              <li>
                {{ dep.prerequisite_task.name }}
                {% if dep.prerequisite_task.completed %}
                  ✅
                {% else %}
                  ❌
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  {% empty %}
    <p>No dependencies yet.</p>
  {% endfor %}
</div>

<!-- Add Dependency Button -->
<div class="mt-3">
  <a href="{% url 'add_dependency' task.id %}" class="btn btn-primary">
    Add Dependency
  </a>
</div>

<!-- Delete Button -->
<form action="{% url 'delete_task' task.id %}" method="post"
      onsubmit="return confirm('Are you sure you want to delete this task and all its subtasks?');">
  {% csrf_token %}
  <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
</form>
{% endblock %}
