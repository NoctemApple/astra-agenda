<div class="accordion-item">
  <h2 class="accordion-header" id="heading-{{ task.id }}">
    <div class="d-flex justify-content-between align-items-center">
      <button class="accordion-button no-arrow collapsed flex-grow-1" type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapse-{{ task.id }}">
        {{ task.name }}
      </button>
      <form action="{% url 'complete_task' task.id %}" method="post" class="ms-2">
        {% csrf_token %}
        <button type="submit" class="btn btn-sm btn-success"
                {% if not task.can_complete %}disabled{% endif %}>Complete</button>
      </form>
    </div>
  </h2>

  <div id="collapse-{{ task.id }}" class="accordion-collapse collapse"
       data-bs-parent="#{{ parent_accordion_id }}">
    <div class="accordion-body">
      <p><strong>Deadline:</strong> {{ task.deadline|default:"None" }}</p>
      <p>{{ task.description }}</p>
      <a href="{% url 'task_detail' task.id %}" class="btn btn-sm btn-primary">View Details</a>

      {% if task.subtasks.all and level < 3 %}
        <div class="accordion mt-3" id="accordion-{{ task.id }}">
          {% for subtask in task.subtasks.all %}
            {% include "tasks/task_item.html" with task=subtask parent_accordion_id="accordion-"|add:task.id level=level|add:"1" %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
