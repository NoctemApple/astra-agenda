<div class="accordion-item">
  <h2 class="accordion-header" id="heading-task-{{ task.id }}">
    <div class="d-flex justify-content-between align-items-center w-100">
      <!-- Left: Accordion toggle -->
      <button class="accordion-button collapsed flex-grow-1 text-start" type="button"
              data-bs-toggle="collapse"
              data-bs-target="#collapse-task-{{ task.id }}">
        {{ task.name }}
      </button>

      <!-- Right: Action buttons -->
      <div class="ms-2 me-3">
        <a href="{% url 'task_detail' task.id %}" class="btn btn-sm btn-outline-info">View</a>
        <form method="post" action="{% url 'complete' task.id %}" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-sm btn-outline-success">✔</button>
        </form>
      </div>
    </div>
  </h2>

  <div id="collapse-task-{{ task.id }}" class="accordion-collapse collapse">
    <div class="accordion-body">
      <p>{{ task.description }}</p>
      <p><strong>Deadline:</strong> {{ task.deadline|default:"No deadline" }}</p>

      <!-- ✅ Recursive subtasks -->
      {% if task.subtasks.all %}
        <div class="accordion ms-3" id="subtaskAccordion-{{ task.id }}">
          {% for sub in task.subtasks.all %}
            {% include "tasks/task_item.html" with task=sub %}
          {% endfor %}
        </div>
      {% endif %}
    </div>
  </div>
</div>
